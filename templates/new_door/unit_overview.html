{% extends 'base.html' %} {% load static %} {% load humanize %} {% block title %} Unit Overview {% endblock title %} {% block body %}
<div class="alert alert-success alert-dismissible fade show" style="display: none;" role="alert">
  <span class="message"></span>
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="row">
      <div class="col-lg-3 col-md-6 col-sm-6">
        <div
          class="card card-stats"
          style="
            background: linear-gradient(to bottom, #eee16a 0%, #ffffff 120%);
          "
        >
          <div class="card-header card-header-warning card-header-icon">
            <div class="card-icon">
              <i class="material-icons">account_balance_wallet</i>
            </div>
            <h3 class="card-title">
              {% if total_earning == 0 %}
                0
              {% elif total_earning.amount == None %}
                0
              {% elif not total_earning.amount == 0 %}
                {{ total_earning.amount|intcomma }}
              {% else %}
                0
              {% endif %} 
            </h3>
            <br /><br />
            <p class="card-category">Total Earnings</p>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-6">
        <div
          class="card card-stats"
          style="
            background: linear-gradient(to bottom, #fda3c8 0%, #ffffff 120%);
          "
        >
          <div class="card-header card-header-rose card-header-icon">
            <div class="card-icon">
              <i class="material-icons">account_balance_wallet</i>
            </div>
              <h3 class="card-title" id="totalDueAmounts"></h3>
            <br /><br />
            <p class="card-category">Total Dues Amount</p>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-6">
        <div
          class="card card-stats"
          style="
            background: linear-gradient(to bottom, #ffa26c 0%, #ffffff 120%);
          "
        >
          <div class="card-header card-header-success card-header-icon">
            <div class="card-icon">
              <i class="material-icons">home</i>
            </div>
            <h3 class="card-title">{{ number_of_occupied_units }}</h3>
            <br /><br />
            <p class="card-category">Total Occupied</p>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-6">
        <div
          class="card card-stats"
          style="
            background: linear-gradient(to bottom, #dd6cff 0%, #ffffff 120%);
          "
        >
          <div class="card-header card-header-info card-header-icon">
            <div class="card-icon">
              <i class="material-icons">vpn_key</i>
            </div>
            <h3 class="card-title">{{ number_of_vacant_units }}</h3>
            <br /><br />
            <p class="card-category">Total Vacant</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card mt-5">
    <div class="card-header card-header-primary card-header-icon">
      <div class="card-icon" style="padding-left: 1px">
        <a
          href=" {% url 'unit_overview' %} "
          class="card-header card-header-rose card-header-text"
          style="font-size: 20px"
        >
          <i class="material-icons">house</i> Unit Overview
        </a>
      </div>
      <div
        class="card-icon float-right"
        style="padding: 0.5em 0; font-size: 1rem"
      >
        <a
          href=" {% url 'add_unit' %} "
          class="card-header card-header-rose card-header-text"
        >
          <i class="material-icons">add</i>Add Unit
        </a>
      </div>
    </div>
    <div class="card-body" id="invite-user-modal">
      <div class="toolbar">
        <!--Here you can write extra buttons/actions for the toolbar -->
      </div>
      <div class="material-datatables">
        <table
          id="datatables"
          class="table table-striped table-no-bordered table-hover"
          cellspacing="0"
          width="100%"
          style="width: 100%"
        >
          <thead>
            <tr>
              <th>Unit Flat</th>
              <th>Type</th>
              <th>Occupancy</th>
              <th>Tenant</th>
              <th>Total Amount</th>
              <th>Collected</th>
              <th>Due Amount</th>
              <th class="disabled-sorting text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% if units %} {% for unit in units %}
            <tr>
              <td>{{unit.flat}}</td>
              <td>{{unit.property_type.property_type}}</td>
              <td>
                {% if unit.occupancy_type.occupancy_type.lower == 'vacant' %}
                <a
                  href="{% url 'add_tenant_to_unit' unit.pk %}"
                  class="btn btn-primary btn-round occupancy_type"
                >
                  {{ unit.occupancy_type.occupancy_type }}
                </a>

                {% elif unit.occupancy_type.occupancy_type.lower == 'document pending' %} 
                {% if unit.tenantcontract.tenant.uploaddocument_set.all.count > 0 %}

                <a
                  href="{% url 'verify_documents' unit.tenantcontract.tenant.user.username %}"
                  class="btn btn-primary btn-round occupancy_type"
                >
                  {{ unit.occupancy_type.occupancy_type }}
                </a>
                {% else %}
                <button
                  class="btn btn-primary btn-round occupancy_type"
                  disabled
                >
                  {{ unit.occupancy_type.occupancy_type }}
                </button>
                {% endif %} 
                {% elif unit.occupancy_type.occupancy_type.lower == 'create contract' %}
                <a
                  href="{% url 'add_tetant_contract' unit.tenantcontract.tenant.user.username %}"
                  class="btn btn-primary btn-round occupancy_type"
                >
                  {{ unit.occupancy_type.occupancy_type }}
                </a>
                {% else %}
                <button
                  class="btn btn-primary btn-round occupancy_type"
                  disabled
                >
                  {{ unit.occupancy_type.occupancy_type }}
                </button>
                {% endif %}
              </td>
              <td>{{ unit.tenantcontract.tenant.user.get_full_name.capitalize }}</td>
              <td class="rental_amount">
                {% if unit.tenantcontract.annual_rent %}
                  {{ unit.tenantcontract.annual_rent|intcomma }}
                {% endif %}
              </td>
              <td class="amount"></td>  
              <td class="remain_amount">
                {% if unit.tenantcontract.payment_set.all %}
                  {% for payment in unit.tenantcontract.payment_set.all %}
                    {% if forloop.last %}
                      {{ payment.remain_amount|intcomma }}
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </td>

              <td class="text-right">
                <a href="#" class="d-inline" title="Renewal">
                  <i
                    class="material-icons"
                    style="
                      margin-right: 5px;
                      margin-top: 10px;
                      margin-bottom: 20px;
                      color: #f44336;
                    "
                    >autorenew</i
                  >
                  <div class="ripple-container"></div>
                </a>

                <a href="#" class="d-inline" title="Maintenance">
                  <i
                    class="material-icons"
                    style="
                      margin-right: 5px;
                      margin-top: 10px;
                      margin-bottom: 20px;
                      color: #6663ff;
                    "
                    >construction</i
                  >
                  <div class="ripple-container"></div>
                </a>

                <a
                  href="{% url 'view_unit' unit.pk  %}"
                  class="d-inline"
                  rel="tooltip "
                  title="View unit"
                  data-original-title="Remove "
                >
                  <div class="ripple-container success"></div>
                  <i
                    class="material-icons"
                    style="
                      margin-right: 10px;
                      margin-top: 10px;
                      margin-bottom: 20px;
                      color: #ff9800;
                    "
                    >dvr</i
                  >
                </a>

                <a
                  href="{% url 'update_unit' unit.pk %}"
                  class="d-inline"
                  title="Update unit"
                >
                  <div class="ripple-container success"></div>
                  <i
                    class="material-icons"
                    style="
                      margin-right: 5px;
                      margin-top: 10px;
                      margin-bottom: 20px;
                      color: #4caf50;
                    "
                    >create</i
                  >
                </a>            
                {% if unit.tenantcontract.tenant.user.username %}
              <a
                href="{% url 'review_documents' unit.tenantcontract.tenant.user.username %} "
                class="d-inline delete-item"
                title="View contract"
              >
                <i
                  class="material-icons"
                  style="
                    margin-right: 5px;
                    margin-top: 10px;
                    margin-bottom: 20px;
                    color: #0e352b;
                  "
                  >description</i
                >
                <div class="ripple-container"></div>
              </a>
            {% endif %}

              {% if request.user.is_superuser %}
              <a
                  href="#"
                  class="d-inline delete-item btn-delete"
                  title="Delete unit"
                  data-target="#deleteToggle"
                  data-toggle="modal"
                  data-pk="{{unit.pk}}" data-name="{{ unit.flat }}"
                >
                  <i
                    class="material-icons"
                    style="
                      margin-right: 5px;
                      margin-top: 10px;
                      margin-bottom: 20px;
                      color: #c55d55;
                    "
                    >delete</i
                  >
                  <div class="ripple-container"></div>
              </a>
              {% endif %}
          </td>
        </tr>

          {% endfor %}
          {% else %} 
          <tr><td colspan="8" class="text-center">No Units</td></tr>  
          {% endif %}

        </tbody>
        </table>
        <!-- Modal -->
        <div class="modal fade" id="deleteToggle" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-top" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <!-- <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5> -->
                <button type="button" class="close p-3" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-info" data-dismiss="modal">No</button>
                <a href="" type="button" class="btn btn-danger confirmation" data-dismiss="modal">Yes</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- end content-->
  </div>
  <!--  end card  -->
  
  
</div>
<!-- end row -->
{% endblock %} 
{% block unit_overview %}
<script src="{% static 'js/unit_overview.js' %}"> </script>
{% endblock %}